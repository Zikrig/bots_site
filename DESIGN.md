# Дизайн-документ: Сайт-витрина Telegram-ботов

## 1. Обзор проекта

**Цель:** Сайт для демонстрации типов Telegram-ботов, которые можно заказать. Посетители видят каталог «товаров» (типов ботов), могут оставить заявку на обратный звонок. Админы управляют каталогом и заявками.

**Целевая аудитория:**
- Обычные пользователи — просмотр каталога, отправка заявки (телефон).
- Администраторы — CRUD товаров, порядок отображения, видимость, просмотр заявок.

---

## 2. Технологический стек

| Слой | Технология | Обоснование |
|------|------------|-------------|
| Backend | **FastAPI** | Быстро, асинхронно, автодокументация OpenAPI, типизация |
| БД | **MySQL 8** | Надёжность, привычный стек, полнотекстовый поиск при необходимости |
| ORM | **SQLAlchemy 2.0** (async) | Стандарт для Python, миграции через Alembic |
| Фронтенд | **Шаблоны Jinja2 + HTMX** или **отдельный SPA (React/Vue)** | Рекомендация: Jinja2 + HTMX + Tailwind — меньше сложности, быстрая разработка, SEO |
| Стили | **Tailwind CSS** | Быстрый современный UI без тяжёлого фреймворка |
| Аутентификация админов | **JWT** в cookie (httpOnly) или **session-based** | Сессии проще для админки с одним/несколькими админами |
| Валидация | **Pydantic** | Уже в FastAPI, валидация API и форм |

**Альтернатива фронтенду:** Если нужен максимально «приложенческий» интерфейс — Nuxt 3 или Next.js с отдельным API; тогда FastAPI только как REST API.

---

## 3. Структура проекта (рекомендуемая)

```
bots_site/
├── app/
│   ├── __init__.py
│   ├── main.py              # точка входа FastAPI
│   ├── config.py            # настройки (env, секреты)
│   ├── database.py          # подключение к MySQL, сессия
│   ├── models/              # SQLAlchemy модели
│   │   ├── __init__.py
│   │   ├── product.py
│   │   ├── lead.py
│   │   └── admin.py
│   ├── schemas/             # Pydantic схемы
│   │   ├── __init__.py
│   │   ├── product.py
│   │   ├── lead.py
│   │   └── admin.py
│   ├── api/
│   │   ├── __init__.py
│   │   ├── deps.py          # зависимости: get_db, get_current_admin
│   │   ├── v1/
│   │   │   ├── __init__.py
│   │   │   ├── products.py  # публичные + админские эндпоинты товаров
│   │   │   ├── leads.py     # создание заявки + админ: список заявок
│   │   │   └── admin.py     # логин/логаут, смена пароля при необходимости
│   ├── services/            # бизнес-логика (опционально)
│   │   ├── __init__.py
│   │   └── auth.py
│   ├── templates/           # Jinja2 шаблоны
│   │   ├── base.html
│   │   ├── index.html
│   │   ├── admin/
│   │   │   ├── login.html
│   │   │   ├── dashboard.html
│   │   │   ├── products.html
│   │   │   └── leads.html
│   └── static/
│       ├── css/
│       ├── js/
│       └── images/
├── alembic/                 # миграции БД
│   ├── env.py
│   └── versions/
├── tests/
├── .env.example
├── requirements.txt
├── DESIGN.md                # этот документ
└── README.md
```

---

## 4. Схема базы данных (MySQL)

### 4.1 Таблица `products` (товары — типы ботов)

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | INT, PK, AUTO_INCREMENT | Идентификатор |
| `title` | VARCHAR(255) | Название (например, «Бот для доставки») |
| `slug` | VARCHAR(255), UNIQUE | URL-friendly идентификатор (опционально для ЧПУ) |
| `description` | TEXT | Описание возможностей бота |
| `short_description` | VARCHAR(500) | Краткое описание для карточки в сетке |
| `image_url` | VARCHAR(512) | Ссылка на изображение или путь к файлу |
| `sort_order` | INT, DEFAULT 0 | Порядок отображения в сетке (меньше — выше) |
| `is_visible` | BOOLEAN, DEFAULT TRUE | Показывать на сайте или скрыть |
| `created_at` | DATETIME | Дата создания |
| `updated_at` | DATETIME | Дата обновления |

**Индексы:** `sort_order`, `is_visible`, при необходимости — `slug`.

### 4.2 Таблица `leads` (заявки на обратный звонок)

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | INT, PK, AUTO_INCREMENT | Идентификатор |
| `phone` | VARCHAR(20) | Телефон клиента |
| `name` | VARCHAR(255), NULL | Имя (опционально) |
| `comment` | TEXT, NULL | Комментарий (опционально) |
| `created_at` | DATETIME | Время заявки |
| `status` | ENUM('new','contacted','closed') | Статус обработки (для админки) |

**Индексы:** `created_at`, `status`.

### 4.3 Таблица `admins` (администраторы)

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | INT, PK, AUTO_INCREMENT | Идентификатор |
| `username` | VARCHAR(64), UNIQUE | Логин |
| `password_hash` | VARCHAR(255) | Хэш пароля (bcrypt) |
| `created_at` | DATETIME | Дата создания |

---

## 5. API (FastAPI)

### 5.1 Публичные эндпоинты (без авторизации)

| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/` | Главная: сетка товаров (только видимые, по `sort_order`) |
| GET | `/api/v1/products` | Список видимых товаров (JSON, для SPA при необходимости) |
| POST | `/api/v1/leads` | Создание заявки: `{ "phone": "+7...", "name?", "comment?" }` |

### 5.2 Админские эндпоинты (требуется авторизация)

**Авторизация:**
- POST `/api/v1/admin/login` — тело: `username`, `password`; ответ: установка cookie сессии (или JWT).
- POST `/api/v1/admin/logout` — выход.

**Товары:**
- GET `/api/v1/admin/products` — все товары (включая скрытые), в порядке `sort_order`.
- POST `/api/v1/admin/products` — создание товара.
- GET `/api/v1/admin/products/{id}` — один товар.
- PATCH `/api/v1/admin/products/{id}` — обновление (в т.ч. `sort_order`, `is_visible`).
- DELETE `/api/v1/admin/products/{id}` — удаление.
- PATCH `/api/v1/admin/products/reorder` — массовое обновление порядка: `[{ "id": 1, "sort_order": 0 }, ...]`.

**Заявки:**
- GET `/api/v1/admin/leads` — список заявок (пагинация, фильтр по статусу).
- PATCH `/api/v1/admin/leads/{id}` — смена статуса.

При выборе **Jinja2 + HTMX** часть сценариев (форма заявки, админские таблицы) может работать через рендер фрагментов HTML без отдельного SPA.

---

## 6. Аутентификация администраторов

- **Вариант A (рекомендуется для простоты):** Сессии в Redis или в БД (таблица `sessions`), cookie `session_id` (httpOnly, secure в prod). После логина проверка сессии в dependency `get_current_admin`.
- **Вариант B:** JWT в httpOnly cookie. Access token с ограниченным TTL; при необходимости refresh token в БД.

Первый пользователь-админ создаётся через CLI/скрипт или миграцию с дефолтным паролем (сменить при первом входе).

---

## 7. Дизайн и UX (общие принципы)

- **Главная страница:** Герой-блок с заголовком и призывом оставить заявку; ниже — сетка карточек товаров (типов ботов). Карточка: изображение, название, короткое описание, кнопка «Подробнее» или раскрытие текста.
- **Единый стиль:** Один акцентный цвет (например, цвет бренда Telegram или свой), нейтральный фон, чёткая типографика (один шрифт заголовков, один — текста).
- **Адаптивность:** Сетка на мобильных — 1 колонка, на планшете — 2, на десктопе — 3.
- **Форма заявки:** Минимум полей — телефон обязательный; имя и комментарий опционально. Валидация на клиенте и на API. После отправки — сообщение «Спасибо, мы перезвоним» без перезагрузки (HTMX или fetch).
- **Админка:** Отдельный раздел `/admin`: логин → дашборд со ссылками на «Товары» и «Заявки». Таблицы с сортировкой/фильтрами; редактирование товара — форма (модалка или отдельная страница); перетаскивание для изменения порядка (drag-and-drop с сохранением в API).

Визуальный референс стиля: современные лендинги SaaS (чисто, много воздуха, карточки с тенями или тонкими границами).

---

## 8. Безопасность

- Пароли админов: только хэш (bcrypt), соль.
- Защита от брутфорса: ограничение попыток входа по IP (например, 5 попыток за 15 минут).
- Заявки: лимит на количество заявок с одного IP за сутки (защита от спама).
- В продакшене: HTTPS, secure cookie, CORS только с доверенных доменов.
- Валидация и санитизация всех вводов (Pydantic, экранирование в шаблонах).

---

## 9. Окружение и деплой

- Конфигурация через переменные окружения: `DATABASE_URL` (MySQL), `SECRET_KEY`, `ADMIN_USERNAME`/первый пароль при первом запуске — по желанию.
- Миграции: Alembic, применение при деплое.
- Запуск: `uvicorn app.main:app --host 0.0.0.0 --port 8000`; в проде — за reverse proxy (Nginx) с SSL.

---

## 10. Этапы реализации (кратко)

1. Инициализация проекта: FastAPI, структура папок, `config`, `database`, зависимости.
2. Модели и миграции: `products`, `leads`, `admins` (и при необходимости `sessions`).
3. Публичное API: получение списка товаров, создание заявки.
4. Шаблоны главной страницы и форма заявки (Jinja2 + Tailwind).
5. Аутентификация админов и защита админских маршрутов.
6. Админские эндпоинты и страницы: товары (CRUD, порядок, видимость), заявки (список, статусы).
7. Полировка UI, валидация, лимиты, деплой.

Этот документ можно использовать как единый источник правды при разработке и доработках проекта.
